#!/bin/sh

VERSION=$1

SRCDIR=roadmap/src
ARMDIR=arm/roadmap/src
IPKGDIR=arm/roadmap/ipkg

rm -rf $IPKGDIR

# --------------------------------------------------------------------------
echo "Building package 'roadmap' .."

mkdir -p $IPKGDIR/roadmap/CONTROL
sed -e s/_VERSION_/$VERSION/ $SRCDIR/ipkg/roadmap.control >$IPKGDIR/roadmap/CONTROL/control
cp $SRCDIR/ipkg/roadmap.postinst $IPKGDIR/roadmap/CONTROL/postinst
cp $SRCDIR/ipkg/roadmap.postrm   $IPKGDIR/roadmap/CONTROL/postrm
chmod a+x $IPKGDIR/roadmap/CONTROL/postinst $IPKGDIR/roadmap/CONTROL/postrm

mkdir -p $IPKGDIR/roadmap/usr/bin
cp $ARMDIR/gtk2/gtkroadmap $IPKGDIR/roadmap/usr/bin/roadmap
cp $ARMDIR/gtk2/gtkroadgps $IPKGDIR/roadmap/usr/bin/roadgps

mkdir -p $IPKGDIR/roadmap/usr/share/applications
cp $SRCDIR/roadmap.desktop $IPKGDIR/roadmap/usr/share/applications

mkdir -p $IPKGDIR/roadmap/usr/share/pixmaps
cp $SRCDIR/roadmap*.png $IPKGDIR/roadmap/usr/share/pixmaps
cp $SRCDIR/icons/rm_*.png $IPKGDIR/roadmap/usr/share/pixmaps

mkdir -p $IPKGDIR/roadmap/usr/share/roadmap
cp $SRCDIR/schema      $IPKGDIR/roadmap/usr/share/roadmap/schema
cp $SRCDIR/sprites     $IPKGDIR/roadmap/usr/share/roadmap/sprites
cp roadmap/README      $IPKGDIR/roadmap/usr/share/roadmap/README

sed -e 's/Map.Path:.*$/Map.Path: \&\/maps,\/usr\/share\/roadmap,\/mnt\/hda\/share\/roadmap\/,\/mnt\/card\/share\/roadmap/' < $SRCDIR/preferences > $IPKGDIR/roadmap/usr/share/roadmap/preferences

bash roadmap/ipkg-build -c -o root -g root $IPKGDIR/roadmap $IPKGDIR


# --------------------------------------------------------------------------
if [ -e $ARMDIR/buildmap ] ; then

  echo "Building package 'buildmap' .."

  mkdir -p $IPKGDIR/buildmap/CONTROL
  sed -e s/_VERSION_/$VERSION/ $SRCDIR/ipkg/roadmap-build.control >$IPKGDIR/buildmap/CONTROL/control

  mkdir -p $IPKGDIR/buildmap/usr/bin
  cp $ARMDIR/buildmap $IPKGDIR/buildmap/usr/bin/buildmap
  cp $ARMDIR/buildus  $IPKGDIR/buildmap/usr/bin/buildus
  cp $ARMDIR/dumpmap  $IPKGDIR/buildmap/usr/bin/dumpmap

  bash roadmap/ipkg-build -c -o root -g root $IPKGDIR/buildmap $IPKGDIR

fi

